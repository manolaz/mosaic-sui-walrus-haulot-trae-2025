{
  "version": 3,
  "sources": ["../../src/uri.ts"],
  "sourcesContent": ["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { isValidNamedType, isValidSuiAddress, isValidSuiObjectId } from '@mysten/sui/utils';\nimport type { PaymentUriParams } from './types.js';\nimport { PaymentKitUriError } from './error.js';\nimport { SUI_PAYMENT_KIT_PROTOCOL } from './constants.js';\n\nconst isValidNonce = (nonce: string) => {\n\treturn nonce.length <= 36;\n};\n\nconst isValidAmount = (amount: bigint) => {\n\treturn amount > 0n;\n};\n\nconst isValidCoinType = (coinType: string) => {\n\treturn isValidNamedType(coinType);\n};\n\n/**\n * Create a payment transaction URI from the given parameters.\n * Returns the constructed URI string.\n *\n * @example\n * ```ts\n * const uri = createPaymentTransactionUri({\n *   receiverAddress: \"0x...\",\n *   amount: \"10000000\", (0.01 SUI)\n *   coinType: \"0x2::sui::SUI\",\n *   nonce: <nonce>,\n *   registryName: \"my-registry\"\n * });\n * ```\n */\nexport const createPaymentTransactionUri = (params: PaymentUriParams): string => {\n\tconst { receiverAddress, amount, coinType, nonce, registryId, registryName } = params;\n\n\tconst uri = new URL(SUI_PAYMENT_KIT_PROTOCOL);\n\n\tif (isValidSuiAddress(receiverAddress)) {\n\t\turi.searchParams.append('receiver', receiverAddress);\n\t} else {\n\t\tthrow new PaymentKitUriError('Invalid Sui address');\n\t}\n\n\tif (isValidAmount(amount)) {\n\t\turi.searchParams.append('amount', amount.toString());\n\t} else {\n\t\tthrow new PaymentKitUriError('Amount must be a positive numeric string');\n\t}\n\n\tif (isValidCoinType(coinType)) {\n\t\turi.searchParams.append('coinType', coinType);\n\t} else {\n\t\tthrow new PaymentKitUriError('Invalid Coin Type');\n\t}\n\n\tif (isValidNonce(nonce)) {\n\t\turi.searchParams.append('nonce', nonce);\n\t} else {\n\t\tthrow new PaymentKitUriError('Nonce length exceeds maximum of 36 characters');\n\t}\n\n\tif (registryId) {\n\t\tif (isValidSuiObjectId(registryId)) {\n\t\t\turi.searchParams.append('registry', registryId);\n\t\t} else {\n\t\t\tthrow new PaymentKitUriError('Invalid Sui Object Id for Registry Id');\n\t\t}\n\t}\n\n\tif (registryName) {\n\t\turi.searchParams.append('registry', registryName);\n\t}\n\n\tif (params.label) {\n\t\turi.searchParams.append('label', params.label);\n\t}\n\n\tif (params.message) {\n\t\turi.searchParams.append('message', params.message);\n\t}\n\n\tif (params.iconUrl) {\n\t\turi.searchParams.append('iconUrl', params.iconUrl);\n\t}\n\n\treturn uri.toString();\n};\n\n/**\n * Parse a payment transaction URI into its components.\n * Returns the parsed payment URI parameters.\n *\n * @example\n * ```ts\n * const params = parsePaymentTransactionUri(\"sui:0x...?amount=1000000&coinType=0x...&nonce=...\");\n * ```\n */\nexport const parsePaymentTransactionUri = (uri: string): PaymentUriParams => {\n\tif (!uri.startsWith(SUI_PAYMENT_KIT_PROTOCOL + '?')) {\n\t\tthrow new PaymentKitUriError('Invalid URI: Must start with sui:pay?');\n\t}\n\n\tconst url = new URL(uri);\n\n\t// Extract query parameters\n\tconst params = url.searchParams;\n\tconst receiver = params.get('receiver');\n\tconst amount = params.get('amount');\n\tconst coinType = params.get('coinType');\n\tconst nonce = params.get('nonce');\n\n\t// Amount and CoinType are required\n\tif (!receiver || !amount || !coinType || !nonce) {\n\t\tthrow new PaymentKitUriError('Invalid URI: Missing required parameters');\n\t}\n\n\t// Validate the receiver address\n\tif (!isValidSuiAddress(receiver)) {\n\t\tthrow new PaymentKitUriError('Invalid URI: Receiver address is not valid');\n\t}\n\n\tif (!isValidCoinType(coinType)) {\n\t\tthrow new PaymentKitUriError('Invalid URI: Coin Type is not valid');\n\t}\n\n\tif (!isValidNonce(nonce)) {\n\t\tthrow new PaymentKitUriError('Invalid URI: Nonce length exceeds maximum of 36 characters');\n\t}\n\n\t// Validate amount is a valid numeric string (int or float) and positive\n\tconst bigIntAmount = BigInt(amount);\n\tif (!isValidAmount(bigIntAmount)) {\n\t\tthrow new PaymentKitUriError('Invalid URI: Amount must be a positive number');\n\t}\n\n\t// Extract optional registry parameter\n\tconst registry = params.get('registry') ?? undefined;\n\n\t// Determine if registry is an ID or name\n\tlet registryId: string | undefined;\n\tlet registryName: string | undefined;\n\n\tif (registry) {\n\t\tif (isValidSuiObjectId(registry)) {\n\t\t\tregistryId = registry;\n\t\t} else {\n\t\t\tregistryName = registry;\n\t\t}\n\t}\n\n\tconst baseParams = {\n\t\treceiverAddress: receiver,\n\t\tamount: bigIntAmount,\n\t\tcoinType,\n\t\tnonce: nonce,\n\t\tlabel: params.get('label') ?? undefined,\n\t\tmessage: params.get('message') ?? undefined,\n\t\ticonUrl: params.get('icon') ?? undefined,\n\t};\n\n\tif (registryId) {\n\t\treturn { ...baseParams, registryId };\n\t}\n\n\treturn { ...baseParams, registryName };\n};\n"],
  "mappings": "AAGA,SAAS,kBAAkB,mBAAmB,0BAA0B;AAExE,SAAS,0BAA0B;AACnC,SAAS,gCAAgC;AAEzC,MAAM,eAAe,CAAC,UAAkB;AACvC,SAAO,MAAM,UAAU;AACxB;AAEA,MAAM,gBAAgB,CAAC,WAAmB;AACzC,SAAO,SAAS;AACjB;AAEA,MAAM,kBAAkB,CAAC,aAAqB;AAC7C,SAAO,iBAAiB,QAAQ;AACjC;AAiBO,MAAM,8BAA8B,CAAC,WAAqC;AAChF,QAAM,EAAE,iBAAiB,QAAQ,UAAU,OAAO,YAAY,aAAa,IAAI;AAE/E,QAAM,MAAM,IAAI,IAAI,wBAAwB;AAE5C,MAAI,kBAAkB,eAAe,GAAG;AACvC,QAAI,aAAa,OAAO,YAAY,eAAe;AAAA,EACpD,OAAO;AACN,UAAM,IAAI,mBAAmB,qBAAqB;AAAA,EACnD;AAEA,MAAI,cAAc,MAAM,GAAG;AAC1B,QAAI,aAAa,OAAO,UAAU,OAAO,SAAS,CAAC;AAAA,EACpD,OAAO;AACN,UAAM,IAAI,mBAAmB,0CAA0C;AAAA,EACxE;AAEA,MAAI,gBAAgB,QAAQ,GAAG;AAC9B,QAAI,aAAa,OAAO,YAAY,QAAQ;AAAA,EAC7C,OAAO;AACN,UAAM,IAAI,mBAAmB,mBAAmB;AAAA,EACjD;AAEA,MAAI,aAAa,KAAK,GAAG;AACxB,QAAI,aAAa,OAAO,SAAS,KAAK;AAAA,EACvC,OAAO;AACN,UAAM,IAAI,mBAAmB,+CAA+C;AAAA,EAC7E;AAEA,MAAI,YAAY;AACf,QAAI,mBAAmB,UAAU,GAAG;AACnC,UAAI,aAAa,OAAO,YAAY,UAAU;AAAA,IAC/C,OAAO;AACN,YAAM,IAAI,mBAAmB,uCAAuC;AAAA,IACrE;AAAA,EACD;AAEA,MAAI,cAAc;AACjB,QAAI,aAAa,OAAO,YAAY,YAAY;AAAA,EACjD;AAEA,MAAI,OAAO,OAAO;AACjB,QAAI,aAAa,OAAO,SAAS,OAAO,KAAK;AAAA,EAC9C;AAEA,MAAI,OAAO,SAAS;AACnB,QAAI,aAAa,OAAO,WAAW,OAAO,OAAO;AAAA,EAClD;AAEA,MAAI,OAAO,SAAS;AACnB,QAAI,aAAa,OAAO,WAAW,OAAO,OAAO;AAAA,EAClD;AAEA,SAAO,IAAI,SAAS;AACrB;AAWO,MAAM,6BAA6B,CAAC,QAAkC;AAC5E,MAAI,CAAC,IAAI,WAAW,2BAA2B,GAAG,GAAG;AACpD,UAAM,IAAI,mBAAmB,uCAAuC;AAAA,EACrE;AAEA,QAAM,MAAM,IAAI,IAAI,GAAG;AAGvB,QAAM,SAAS,IAAI;AACnB,QAAM,WAAW,OAAO,IAAI,UAAU;AACtC,QAAM,SAAS,OAAO,IAAI,QAAQ;AAClC,QAAM,WAAW,OAAO,IAAI,UAAU;AACtC,QAAM,QAAQ,OAAO,IAAI,OAAO;AAGhC,MAAI,CAAC,YAAY,CAAC,UAAU,CAAC,YAAY,CAAC,OAAO;AAChD,UAAM,IAAI,mBAAmB,0CAA0C;AAAA,EACxE;AAGA,MAAI,CAAC,kBAAkB,QAAQ,GAAG;AACjC,UAAM,IAAI,mBAAmB,4CAA4C;AAAA,EAC1E;AAEA,MAAI,CAAC,gBAAgB,QAAQ,GAAG;AAC/B,UAAM,IAAI,mBAAmB,qCAAqC;AAAA,EACnE;AAEA,MAAI,CAAC,aAAa,KAAK,GAAG;AACzB,UAAM,IAAI,mBAAmB,4DAA4D;AAAA,EAC1F;AAGA,QAAM,eAAe,OAAO,MAAM;AAClC,MAAI,CAAC,cAAc,YAAY,GAAG;AACjC,UAAM,IAAI,mBAAmB,+CAA+C;AAAA,EAC7E;AAGA,QAAM,WAAW,OAAO,IAAI,UAAU,KAAK;AAG3C,MAAI;AACJ,MAAI;AAEJ,MAAI,UAAU;AACb,QAAI,mBAAmB,QAAQ,GAAG;AACjC,mBAAa;AAAA,IACd,OAAO;AACN,qBAAe;AAAA,IAChB;AAAA,EACD;AAEA,QAAM,aAAa;AAAA,IAClB,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR;AAAA,IACA;AAAA,IACA,OAAO,OAAO,IAAI,OAAO,KAAK;AAAA,IAC9B,SAAS,OAAO,IAAI,SAAS,KAAK;AAAA,IAClC,SAAS,OAAO,IAAI,MAAM,KAAK;AAAA,EAChC;AAEA,MAAI,YAAY;AACf,WAAO,EAAE,GAAG,YAAY,WAAW;AAAA,EACpC;AAEA,SAAO,EAAE,GAAG,YAAY,aAAa;AACtC;",
  "names": []
}
